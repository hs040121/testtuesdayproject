# 캡스톤 프로젝트

## 특징 공학 기반 포렌식 분석과 딥러닝 앙상블을 활용한 AI 이미지 진위 판별 시스템

---

## 1. 서론

### 1.1 프로젝트 개요

본 프로젝트는 사용자가 업로드한 이미지가 **실제 카메라로 촬영된 사진(Real)** 인지, 혹은 **생성형 AI에 의해 합성된 이미지(Fake)** 인지를 판별하는 웹 기반 AI 시스템을 개발하는 것을 목표로 한다. 프로젝트명은 **DeepDetect Pro**로, 단일 딥러닝 분류기에 의존하지 않고 **이미지 포렌식 이론에 기반한 특징 공학 모델**과 **최신 Vision Transformer(ViT)** 모델을 결합한 **이중 판별 구조(Dual Analysis Engine)** 를 핵심 설계로 채택하였다.

특히 본 시스템은 단순히 결과만을 제시하는 것이 아니라, “왜 해당 이미지가 AI 생성 이미지로 판단되었는가?”에 대한 근거를 제공하는 것을 목표로 하였다. 이를 위해 이미지 압축 과정에서 발생하는 오류와 텍스처 패턴의 불일치를 분석하는 **설명 가능한 AI(XAI)** 관점의 접근을 중점적으로 적용하였다.

### 1.2 개발 배경 및 필요성

최근 생성형 AI 기술의 급속한 발전으로 인해 실제 사진과 육안으로 구분하기 어려운 고품질 합성 이미지가 대량으로 생성되고 있다. 이러한 이미지는 가짜 뉴스 확산, 디지털 증거 위·변조, 저작권 침해 등 다양한 사회적 문제를 유발할 가능성이 크다.

기존의 CNN 기반 또는 단일 딥러닝 모델 기반 판별 방식은 높은 성능을 보이기도 하지만, 특정 데이터셋에 과도하게 의존하거나 판별 근거를 명확히 설명하지 못하는 한계가 있다. 이에 따라 이미지의 **물리적 생성 과정에서 자연스럽게 발생하는 흔적**을 분석하는 포렌식 기반 접근과 딥러닝 모델을 결합한 보다 신뢰도 높은 판별 시스템의 필요성이 대두되었다.

---

## 2. 시스템 설계 및 전체 구조

### 2.1 시스템 아키텍처

본 시스템은 **FastAPI 기반 백엔드 서버**와 **HTML/CSS/JavaScript 기반 프론트엔드**로 구성된 웹 애플리케이션 형태로 구현되었다.

* **Frontend**
  사용자는 이미지를 업로드하고, 비동기 방식으로 서버에 분석 요청을 전송한다. 분석 결과는 판별 결과 문구, 모델별 확률 차트, 조작 의심 영역 시각화 형태로 제공된다.

* **Backend**
  업로드된 이미지는 두 개의 독립적인 분석 엔진(Custom Model, ViT Model)에 동시에 전달되며, 각 엔진의 분석 결과를 종합하여 최종 판별에 활용된다.

### 2.2 Dual Analysis Engine 구조

#### 2.2.1 Engine A: 특징 공학 기반 포렌식 모델 (Custom Model)

Engine A는 이미지 포렌식 이론을 직접 구현한 모델로, **RandomForest 분류기**를 기반으로 한다.

* **특징 추출 구성**

  * **ELA (Error Level Analysis)**
    입력 이미지를 4가지 JPEG 품질(Q = 90, 85, 80, 75)로 재압축한 뒤 원본 이미지와의 차이를 계산한다. 각 ELA 결과 이미지에서 히스토그램을 추출하여 **총 40차원 특징 벡터**를 생성한다. 이는 AI 생성 이미지가 재압축 과정에서 비자연적인 주파수 손실 패턴을 보이는 특성을 이용한 것이다.

  * **LBP (Local Binary Patterns)**
    반경 R = 1, 2, 3, 4에 대해 국소 텍스처 패턴을 분석하고, 각 반경별 히스토그램을 결합하여 **88차원 특징 벡터**를 생성한다. 이를 통해 AI 이미지에서 자주 나타나는 미세한 텍스처 불균형을 효과적으로 탐지할 수 있다.

* **전처리 및 학습 과정**
  ELA와 LBP 특징을 결합한 **128차원 특징 벡터**에 대해 StandardScaler를 적용하여 정규화한 후 RandomForest 모델을 학습하였다.

* **성능 평가**
  직접 수집 및 레이블링한 약 39,000장의 실제 사진 및 AI 생성 이미지 데이터셋을 활용하여 실험한 결과, **테스트 정확도 91.93%**를 달성하였다.

* **설명 가능성(XAI)**
  ELA 결과 이미지를 4×4 Grid로 분할하고, 평균 오류 값이 가장 높은 영역을 **조작 의심 영역(Hotspot)** 으로 지정하여 시각적으로 사용자에게 제공한다.

#### 2.2.2 Engine B: Vision Transformer(ViT) 기반 딥러닝 모델

Engine B는 딥러닝 기반의 보조 판별 엔진으로, Hugging Face에서 제공하는 **Vision Transformer(ViT)** 모델을 활용하였다.

* **모델**: `vit-base-patch16-224-in21k-ai-or-real`
* **동작 방식**: 이미지를 16×16 크기의 패치로 분할한 뒤 Self-Attention 메커니즘을 통해 전역 문맥 정보를 학습한다.
* **역할**: 특징 공학 기반 모델이 놓칠 수 있는 고차원 픽셀 패턴을 보완적으로 분석하는 **2차 검증 모델**로 활용된다.
* **출력 처리**: Softmax 함수를 적용하여 Real과 Fake 클래스의 확률 합이 100%가 되도록 정규화하였다.

---

## 3. 개발 환경

| 구분               | 내용                                         |
| ---------------- | ------------------------------------------ |
| Language         | Python 3.10+, JavaScript (ES6)             |
| Backend          | FastAPI, Uvicorn                           |
| Frontend         | HTML5, CSS3, Bootstrap 5, jQuery, Chart.js |
| ML Libraries     | Scikit-learn, PyTorch, Transformers        |
| Image Processing | OpenCV, Pillow, Scikit-image               |
| Dataset          | Real / Fake 이미지 약 39,000장                  |
| IDE              | PyCharm, VS Code                           |

---

## 4. 문제 해결 과정 및 성능 개선

### 4.1 데이터 편향 문제 해결

초기 학습 단계에서 특정 실제 사진이 반복적으로 Fake로 오판되는 문제가 발생하였다. 원인 분석 결과, 이미지 경로에 한글이 포함된 경우 OpenCV의 `imread` 함수가 이미지를 정상적으로 로드하지 못해 **0 벡터 데이터가 학습 데이터에 포함**되고 있음을 확인하였다.

이를 해결하기 위해 이미지 파일을 바이너리 스트림 형태로 직접 읽는 방식(`cv2.imdecode`와 `numpy.frombuffer` 활용)으로 전면 수정하였으며, 특징 추출에 실패한 데이터는 학습 과정에서 제외하도록 처리하여 데이터 무결성을 확보하였다.

### 4.2 학습–서비스 전처리 불일치 문제

모델 재학습 이후에도 웹 서비스 상에서의 판별 정확도가 기대보다 낮게 나타나는 문제가 발생하였다. 분석 결과, 학습 코드와 서버 코드 간 **ELA 특징 추출 기준 이미지가 서로 상이함**을 확인하였다.

이에 따라 서버 코드의 특징 추출 과정을 학습 코드와 완전히 동일하게 수정하여 입력 데이터 분포를 일치시켰고, 그 결과 실제 서비스 환경에서도 안정적인 성능을 확보할 수 있었다.

### 4.3 특징 확장 기반 성능 향상

단일 품질 ELA와 단일 반경 LBP만으로는 다양한 생성형 AI 이미지의 특성을 충분히 포착하기 어렵다는 한계가 있었다. 이를 개선하기 위해 다중 품질 ELA와 다중 반경 LBP로 특징을 확장하였으며, 그 결과 모델의 일반화 성능이 크게 향상되어 **최종 테스트 정확도 91.93%**를 달성하였다.

---

## 5. 결론 및 기대 효과

본 프로젝트는 단순히 딥러닝 모델을 적용하는 데 그치지 않고, **이미지 포렌식 이론을 실제 코드 수준에서 구현**하고 데이터 수집부터 전처리, 학습, 평가, 배포까지 전 과정을 직접 수행했다는 점에서 의의가 있다.

특히 특징 공학 기반 포렌식 모델과 최신 ViT 모델을 결합한 이중 판별 구조를 통해 높은 정확도와 신뢰성을 동시에 확보하였으며, 조작 의심 영역 시각화를 통해 실사용 가능한 설명 가능한 AI 이미지 판별 시스템을 구현하였다.

향후 본 시스템은 가짜 뉴스 탐지, 디지털 포렌식, 저작권 보호, 소셜 미디어 콘텐츠 검증 등 다양한 분야에서 활용될 수 있을 것으로 기대된다.
